hostname {{ data.cisco.hostname }}
!
{% for vrf in data.cisco.vrfs %}
vrf definition {{ vrf.vrf }}
 rd {{ data.cisco.bgp_asn }}:{{ (data.cisco.loopback0_ip_address)[-1] }}
 route-target both {{ vrf.route_target }}
 !
 address-family ipv4
 exit-address-family
!
{% endfor %}
interface Loopback0
 ip address {{ data.cisco.loopback0_ip_address }} 255.255.255.255
 ip router isis
!
{% for interface in data.cisco.interfaces %}
!
interface GigabitEthernet{{ interface.interface_id }}
{% if interface.vrf %}
 vrf forwarding {{ interface.vrf }}
{% endif %}
{% if interface.isis %}
 ip router isis
 mpls ip
{% endif %}
 ip address {{ interface.ip_address }}
 no shut
{% endfor %}
!
{% if data.cisco.isis %}
router isis
 net 49.0001.0000.0000.000{{ (data.cisco.loopback0_ip_address)[-1] }}.00
 metric-style wide
 is-type level-2-only
!
{% endif %}
router bgp {{ data.cisco.bgp_asn }}
{% for peer in data.cisco.bgp %}
 bgp log-neighbor-changes
 neighbor {{ peer.neighbor }} remote-as {{ peer.remote_as }}
 !
{% endfor %}
 !
{% for peer in data.cisco.bgp %}
 address-family vpnv4
  neighbor {{ peer.neighbor }} activate
  neighbor {{ peer.neighbor }} send-community extended
 exit-address-family
 !
{% endfor %}
{% for vrf in data.cisco.vrfs %}
 address-family ipv4 vrf {{ vrf.vrf }}
  redistribute connected
{% if vrf.neighbor %}
  neighbor {{ vrf.neighbor }} remote-as {{ vrf.remote_as }}
  neighbor {{ vrf.neighbor }} activate
  neighbor {{ vrf.neighbor }} send-community
  neighbor {{ vrf.neighbor }} route-map Allow out
 !
{% endif %}

 exit-address-family
!
{% endfor %}
!
route-map Allow permit 10