---

  - name: "First Play: Automate Routing Configs via Jinja2"
    hosts: servers

    vars:
      ip: []
    
    tasks: 

      - name: Setup a string variable
        debug:
          msg: "{{ lookup('template', 'templates/test.j2') }}"
        register: ip

      - debug: var=ip

      - name: Check all port numbers are accessible from current host
        wait_for:
          host: "{{ item }}"
          port: 80
          state: started         # Port should be open
          delay: 0               # No wait before first check (sec)
          timeout: 3             # Stop checking after timeout (sec)
        ignore_errors: yes
        with_items: "{{ ip.split(",") }}"